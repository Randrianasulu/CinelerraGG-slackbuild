From 00021cec83707ee720035102ae291e8d8a16c447 Mon Sep 17 00:00:00 2001
From: Andrew Randrianasulu <randrianasulu@gmail.com>
Date: Fri, 5 Jan 2024 03:51:57 +0300
Subject: [PATCH 2/3] Guard ffmpeg.C stream sample aspect ratio only for few
 formats

---
 cinelerra-5.1/cinelerra/ffmpeg.C | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/cinelerra-5.1/cinelerra/ffmpeg.C b/cinelerra-5.1/cinelerra/ffmpeg.C
index 870cdd3c..cfaa30b4 100644
--- a/cinelerra-5.1/cinelerra/ffmpeg.C
+++ b/cinelerra-5.1/cinelerra/ffmpeg.C
@@ -3037,7 +3037,13 @@ int FFMPEG::open_encoder(const char *type, const char *spec)
 				frame_rate.num, frame_rate.den, INT_MAX);
 			ctx->framerate = (AVRational) { frame_rate.num, frame_rate.den };
 			ctx->time_base = (AVRational) { frame_rate.den, frame_rate.num };
+			printf("ofmt name %s \n", format_name);
+			if(!strcmp(format_name, "webm") || !strcmp(format_name, "mkv") || !strcmp(format_name, "mov") ||
+			!strcmp(format_name, "qt") || !strcmp(format_name, "mp4") || !strcmp(format_name, "avi"))
+			{
+			if (to_sample_aspect_ratio(asset).den > 0)
 			st->sample_aspect_ratio = to_sample_aspect_ratio(asset);
+			}
 			st->avg_frame_rate = frame_rate;
 			st->time_base = ctx->time_base;
 			vid->writing = -1;
-- 
2.35.8

