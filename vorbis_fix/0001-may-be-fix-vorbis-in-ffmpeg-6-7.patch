From a00d181b876c38888630175c4affb9e2df1bff34 Mon Sep 17 00:00:00 2001
From: Andrew Randrianasulu <randrianasulu@gmail.com>
Date: Mon, 22 Apr 2024 09:22:42 +0300
Subject: [PATCH] may be fix vorbis in ffmpeg 6/7 ?

---
 cinelerra-5.1/cinelerra/ffmpeg.C | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/cinelerra-5.1/cinelerra/ffmpeg.C b/cinelerra-5.1/cinelerra/ffmpeg.C
index 2fa3d85d..9b8832dd 100644
--- a/cinelerra-5.1/cinelerra/ffmpeg.C
+++ b/cinelerra-5.1/cinelerra/ffmpeg.C
@@ -641,8 +641,8 @@ int FFStream::encode_frame(AVFrame *frame)
 		if ( ret == AVERROR(EAGAIN) && !frame ) continue;
 		FFPacket opkt;
 		ret = avcodec_receive_packet(avctx, opkt);
-		if( !frame && ret == AVERROR_EOF ) return pkts;
-		if( ret < 0 ) break;
+		if( !frame && (ret == AVERROR_EOF || ret == AVERROR(EAGAIN) )) return pkts;
+		//if( ret < 0 ) break;
 		ret = write_packet(opkt);
 		if( ret < 0 ) break;
 		++pkts;
-- 
2.35.8

