From 9c1d9dd8716ec3fc38e53959c4d4d0abc28bb387 Mon Sep 17 00:00:00 2001
From: Andrew Randrianasulu <randrianasulu@gmail.com>
Date: Mon, 8 Dec 2025 03:39:38 +0300
Subject: [PATCH 1/3] TESTING highbitdepth enable/disable for x265 build

---
 cinelerra-5.1/configure.ac        | 9 +++++++--
 cinelerra-5.1/thirdparty/Makefile | 7 +++++--
 2 files changed, 12 insertions(+), 4 deletions(-)

diff --git a/cinelerra-5.1/configure.ac b/cinelerra-5.1/configure.ac
index 582cc720..7975e4bd 100644
--- a/cinelerra-5.1/configure.ac
+++ b/cinelerra-5.1/configure.ac
@@ -512,7 +512,7 @@ AC_ARG_ENABLE([$1],
 ])
 
 CHECK_ENABLE([static-build], [STATIC_BUILD], [build static], [auto])
-CHECK_ENABLE([x265_hidepth], [X265_HIDEPTH], [build x265 10bit], [no])
+CHECK_ENABLE([x265_hidepth], [X265_HIDEPTH], [build x265 10/12bit], [yes])
 
 test "x$WANT_STATIC_BUILD" = "xauto" && WANT_STATIC_BUILD=$WANT_CINBIN_BUILD
 
@@ -1089,7 +1089,7 @@ fi
 for v in GL XFT XXF86VM OSS ALSA FIREWIRE OGG DV DVB LADSPA \
 	 VIDEO4LINUX2 ESOUND PULSE PACTL OPENEXR LV2 \
 	 COMMERCIAL GIFLIB LIBZMPEG LIBDPX SHUTTLE SHUTTLE_USB XV \
-	 VAAPI VDPAU ONEVPL CUDA NV WINTV X10TV; do
+	 VAAPI VDPAU ONEVPL CUDA NV WINTV X10TV X265_HIDEPTH; do
   eval vv="\$WANT_$v"
   if test "x$vv" != "xno"; then
     CFG_CFLAGS+=" -DHAVE_$v"
@@ -1149,6 +1149,11 @@ if test "x$WANT_NV" != "xno"; then
   CFG_WANTS+=" NV"
 fi
 
+if test "x$WANT_X265_HIDEPTH" != "xno"; then
+  WANT_X265_HIDEPTH="yes"
+  CFG_WANTS+=" X265_HIDEPTH"
+fi
+
 if test "x$HAVE_DL" = "xyes"; then
   EXTRA_LIBS+=' -ldl'
   FFMPEG_EXTRA_LDFLAGS+=' -ldl'
diff --git a/cinelerra-5.1/thirdparty/Makefile b/cinelerra-5.1/thirdparty/Makefile
index b2306e23..05e93089 100644
--- a/cinelerra-5.1/thirdparty/Makefile
+++ b/cinelerra-5.1/thirdparty/Makefile
@@ -274,9 +274,12 @@ tiff.cfg_params+= --disable-libdeflate --disable-lerc --enable-shared=no --disab
  $(call if_npkg,libwebp,--disable-webp)
 twolame.cfg_params?=--enable-shared=no
 x264.cfg_params?= --enable-static --enable-pic --disable-lavf --disable-swscale --disable-ffms --disable-gpac --disable-lsmash
+ifneq ($(WANT_X265_HIDEPTH),no)
 x265.cfg_vars?=chmod +x ./configure; chmod +x ./multilib.sh;
-#x265.cfg_vars?=$(call cmake_config,source)
-#x265.cfg_params?= -DENABLE_SHARED=no -DENABLE_CLI=no
+else
+x265.cfg_vars?=$(call cmake_config,source)
+x265.cfg_params?= -DENABLE_SHARED=no -DENABLE_CLI=no
+endif
 libvpx.cfg_params?= --enable-pic --disable-avx512 --enable-vp9-highbitdepth --disable-examples --disable-unit_tests
 libdpx.cfg_vars?= libtoolize; aclocal; autoconf; automake -a;
 libsndfile.cfg_params+= --disable-shared --enable-static --disable-sqlite --disable-mpeg
-- 
2.46.4

